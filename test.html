<!DOCTYPE html>
<html>
<head>
    <title>Catan WebSocket Test</title>
    <style>
        body { 
            margin: 20px; 
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .commands {
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 5px;
        }
        #messages { 
            height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .message { 
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .sent { 
            color: #2c5282;
            background-color: #ebf8ff;
        }
        .received { 
            color: #276749;
            background-color: #f0fff4;
        }
        .error {
            color: #c53030;
            background-color: #fff5f5;
        }
        button {
            margin: 5px;
            padding: 8px 16px;
            background-color: #4299e1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #3182ce;
        }
        input {
            margin: 5px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Catan Game Test Console</h1>
    
    <div class="container">
        <div class="commands">
            <h2>Game Commands</h2>
            <div>
                <button onclick="joinGame()">Join Game</button>
                <button onclick="rollDice()">Roll Dice</button>
            </div>
            <div>
                <h3>Place Settlement</h3>
                <input type="number" id="settlementX" placeholder="X coordinate">
                <input type="number" id="settlementY" placeholder="Y coordinate">
                <button onclick="placeSettlement()">Place Settlement</button>
            </div>
            <div>
                <h3>Place Road</h3>
                <input type="number" id="roadStartX" placeholder="Start X">
                <input type="number" id="roadStartY" placeholder="Start Y">
                <input type="number" id="roadEndX" placeholder="End X">
                <input type="number" id="roadEndY" placeholder="End Y">
                <button onclick="placeRoad()">Place Road</button>
            </div>
            <div class="game-info">
                <p>Player ID: <span id="playerId">Not connected</span></p>
                <p>Game Phase: <span id="gamePhase">-</span></p>
            </div>
        </div>
        
        <div class="messages-container">
            <h2>Messages</h2>
            <div id="messages"></div>
        </div>
    </div>

    <script>
        let gameState = {
            playerId: null,
            gameId: null,
            phase: null
        };

        const ws = new WebSocket('ws://localhost:8080/ws');
        const messagesDiv = document.getElementById('messages');

        ws.onopen = () => {
            addMessage('Connected to server', 'system');
        };

        ws.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);
                addMessage(`Received: ${JSON.stringify(data, null, 2)}`, 'received');
                
                if (data.GameJoined) {
                    gameState.playerId = data.GameJoined.player_id;
                    updateGameInfo(data.GameJoined.game_state);
                } else if (data.GameStateUpdate) {
                    updateGameInfo(data.GameStateUpdate.game_state);
                }
                
                if (data.Error) {
                    addMessage(`Error: ${data.Error.message}`, 'error');
                }
            } catch (e) {
                addMessage(`Received: ${event.data}`, 'received');
            }
        };

        ws.onclose = () => {
            addMessage('Disconnected from server', 'system');
        };

        function updateGameInfo(state) {
            document.getElementById('playerId').textContent = gameState.playerId || 'Not connected';
            document.getElementById('gamePhase').textContent = JSON.stringify(state.phase);
        }

        function joinGame() {
            const command = {
                type: "JoinGame",
                payload: {
                    player_name: "Player" + Math.floor(Math.random() * 1000)
                }
            };
            sendCommand(command);
        }

        function rollDice() {
            const command = {
                type: "RollDice"
            };
            sendCommand(command);
        }

        function placeSettlement() {
            const x = parseInt(document.getElementById('settlementX').value);
            const y = parseInt(document.getElementById('settlementY').value);
            
            const command = {
                type: "BuildSettlement",
                payload: {
                    position: { x, y }
                }
            };
            sendCommand(command);
        }

        function placeRoad() {
            const startX = parseInt(document.getElementById('roadStartX').value);
            const startY = parseInt(document.getElementById('roadStartY').value);
            const endX = parseInt(document.getElementById('roadEndX').value);
            const endY = parseInt(document.getElementById('roadEndY').value);
            
            const command = {
                type: "BuildRoad",
                payload: {
                    start: { x: startX, y: startY },
                    end: { x: endX, y: endY }
                }
            };
            sendCommand(command);
        }

        function sendCommand(command) {
            ws.send(JSON.stringify(command));
            addMessage(`Sent: ${JSON.stringify(command, null, 2)}`, 'sent');
        }

        function addMessage(message, type) {
            const div = document.createElement('div');
            const pre = document.createElement('pre');
            pre.textContent = message;
            div.appendChild(pre);
            div.className = `message ${type}`;
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    </script>
</body>
</html>